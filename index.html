<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akina Check - Inspecci√≥n Vehicular</title>
    <style>
        /* RESET Y BASE */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            color: #333;
            background: #f5f5f5;
            line-height: 1.5;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        /* HEADER PRINCIPAL */
        .site-header {
            text-align: center;
            padding: 2rem 0 3rem;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 2rem;
        }

        .site-header h1 {
            font-size: 2.5rem;
            color: #1a1a1a;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .site-header p {
            color: #666;
            font-size: 1.1rem;
        }

        /* PORTADA */
        .cover {
            background: white;
            padding: 2.5rem;
            margin-bottom: 2rem;
            border: 1px solid #ddd;
            position: relative;
        }

        .cover::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: #2c3e50;
        }

        .cover-title {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .cover-title h2 {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .cover-title p {
            color: #666;
        }

        /* RECOMENDACI√ìN */
        .recommendation-section {
            background: #f8f9fa;
            padding: 2rem;
            margin: 2.5rem 0;
            border: 1px solid #dee2e6;
        }

        .recommendation-title {
            text-align: center;
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 1.5rem;
        }

        .recommendation-options {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .option {
            text-align: center;
            padding: 1rem 1.5rem;
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            background: white;
            transition: all 0.2s;
            min-width: 180px;
        }

        .option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .option.selected {
            border-color: currentColor;
        }

        .option-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .option-text {
            font-weight: 600;
            font-size: 1rem;
        }

        .option-apto { color: #27ae60; }
        .option-observaciones { color: #f39c12; }
        .option-no-recomendado { color: #e74c3c; }

        /* FORMULARIOS */
        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        /* DATOS DEL VEH√çCULO */
        .vehicle-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
        }

        /* CHECKLIST */
        .checklist-container {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .checklist-category {
            margin-bottom: 2rem;
        }

        .category-header {
            background: #2c3e50;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
        }

        .checklist-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border: 1px solid #eee;
            margin-bottom: 0.5rem;
            background: white;
            border-radius: 4px;
        }

        .checklist-item:hover {
            border-color: #3498db;
        }

        .item-text {
            flex: 1;
            padding-right: 1rem;
        }

        .item-status {
            display: flex;
            gap: 0.5rem;
        }

        .status-btn {
            width: 36px;
            height: 36px;
            border: 2px solid;
            border-radius: 50%;
            background: none;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-btn.selected {
            color: white;
        }

        .status-conforme {
            color: #27ae60;
            border-color: #27ae60;
        }

        .status-conforme.selected {
            background: #27ae60;
        }

        .status-observacion {
            color: #f39c12;
            border-color: #f39c12;
        }

        .status-observacion.selected {
            background: #f39c12;
        }

        .status-no-conforme {
            color: #e74c3c;
            border-color: #e74c3c;
        }

        .status-no-conforme.selected {
            background: #e74c3c;
        }

        /* PANEL DE ASISTENCIA */
        .assistance-panel {
            background: #f8f9fa;
            padding: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin-top: 2rem;
        }

        .counters {
            display: flex;
            gap: 3rem;
            margin-bottom: 1.5rem;
        }

        .counter {
            text-align: center;
        }

        .counter-value {
            display: block;
            font-size: 2rem;
            font-weight: 700;
        }

        .counter-label {
            font-size: 0.9rem;
            color: #666;
        }

        .counter-observaciones .counter-value { color: #f39c12; }
        .counter-no-conformes .counter-value { color: #e74c3c; }

        .assistance-message {
            padding: 1rem;
            background: white;
            border-left: 4px solid #3498db;
            font-style: italic;
        }

        /* VISTA PREVIA */
        .report-preview {
            background: white;
            padding: 2.5rem;
            margin: 2rem 0;
            border: 1px solid #ddd;
        }

        .report-header {
            text-align: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }

        .report-header h2 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .report-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .recommendation-badge {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .badge-apto {
            background: rgba(39, 174, 96, 0.1);
            color: #27ae60;
        }

        .badge-observaciones {
            background: rgba(243, 156, 18, 0.1);
            color: #f39c12;
        }

        .badge-no-recomendado {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        /* BOTONES */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2.5rem 0;
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: #2c3e50;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        /* FOOTER */
        .site-footer {
            text-align: center;
            padding: 2rem 0;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #e0e0e0;
            margin-top: 2rem;
        }

        .developer-credit {
            color: #666;
            text-decoration: none;
            margin-top: 0.5rem;
            display: inline-block;
        }

        .developer-credit:hover {
            text-decoration: underline;
        }

        /* UTILIDADES */
        .text-center { text-align: center; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .vehicle-grid,
            .recommendation-options,
            .counters {
                grid-template-columns: 1fr;
                flex-direction: column;
            }
            
            .report-info {
                flex-direction: column;
                gap: 1.5rem;
            }
        }

        /* IMPRESI√ìN */
        @media print {
            .no-print,
            .action-buttons {
                display: none;
            }
            
            body {
                padding: 0;
                background: white;
            }
            
            .report-preview {
                border: none;
                padding: 0;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <header class="site-header">
        <h1>AKINA CHECK</h1>
        <p>Informe profesional de inspecci√≥n vehicular</p>
    </header>

    <main>
        <!-- PORTADA -->
        <section class="cover">
            <div class="cover-title">
                <h2>Informe de inspecci√≥n vehicular</h2>
                <p>Evaluaci√≥n t√©cnica pre-compra</p>
            </div>

            <div class="recommendation-section">
                <h3 class="recommendation-title">Recomendaci√≥n del inspector</h3>
                
                <div class="recommendation-options">
                    <div class="option option-apto" data-value="apto">
                        <div class="option-icon">üü¢</div>
                        <div class="option-text">Apto para compra</div>
                    </div>
                    
                    <div class="option option-observaciones" data-value="observaciones">
                        <div class="option-icon">üü°</div>
                        <div class="option-text">Apto con observaciones</div>
                    </div>
                    
                    <div class="option option-no-recomendado" data-value="no-recomendado">
                        <div class="option-icon">üî¥</div>
                        <div class="option-text">No recomendado</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Fundamento de la evaluaci√≥n (m√°x. 200 caracteres)</label>
                    <textarea id="fundamento" class="form-textarea" placeholder="Base t√©cnica de la recomendaci√≥n..." maxlength="200"></textarea>
                    <div class="text-right mt-1" style="font-size: 0.85rem; color: #666;">
                        <span id="char-count">0</span>/200
                    </div>
                </div>
            </div>

            <div class="vehicle-grid">
                <div class="form-group">
                    <label class="form-label">Veh√≠culo</label>
                    <input type="text" id="vehiculo" class="form-input" placeholder="Ej: Toyota Corolla 1.8">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Dominio</label>
                    <input type="text" id="dominio" class="form-input" placeholder="Ej: AB 123 CD">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Kilometraje</label>
                    <input type="text" id="kilometraje" class="form-input" placeholder="Ej: 85.500 km">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Fecha de inspecci√≥n</label>
                    <input type="date" id="fecha" class="form-input">
                </div>
            </div>
        </section>

        <!-- CONTENIDO PRINCIPAL -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
            <!-- DATOS Y OBSERVACIONES -->
            <section>
                <div style="background: white; padding: 2rem; border: 1px solid #ddd; border-radius: 6px;">
                    <h3 style="color: #2c3e50; margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #f0f0f0;">
                        üìã Datos del veh√≠culo
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label">Observaciones generales</label>
                        <textarea id="observaciones-generales" class="form-textarea" rows="4" placeholder="Anotaciones relevantes sobre el veh√≠culo..."></textarea>
                    </div>

                    <div class="assistance-panel">
                        <div class="counters">
                            <div class="counter counter-observaciones">
                                <span class="counter-value" id="contador-observaciones">0</span>
                                <span class="counter-label">Observaciones</span>
                            </div>
                            
                            <div class="counter counter-no-conformes">
                                <span class="counter-value" id="contador-no-conformes">0</span>
                                <span class="counter-label">No conformes</span>
                            </div>
                        </div>
                        
                        <div class="assistance-message" id="mensaje-asistencia">
                            Complete el checklist para obtener informaci√≥n contextual.
                        </div>
                    </div>
                </div>
            </section>

            <!-- CHECKLIST -->
            <section>
                <div style="background: white; padding: 2rem; border: 1px solid #ddd; border-radius: 6px; height: 100%;">
                    <h3 style="color: #2c3e50; margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #f0f0f0;">
                        ‚úÖ Checklist de inspecci√≥n
                    </h3>
                    
                    <div class="checklist-container" id="checklist-container">
                        <!-- Generado din√°micamente -->
                    </div>
                </div>
            </section>
        </div>

        <!-- VISTA PREVIA -->
        <section class="report-preview" id="report-preview">
            <div class="report-header">
                <h2>INFORME DE INSPECCI√ìN VEHICULAR</h2>
                <p style="color: #666;">AKINA CHECK ¬∑ Evaluaci√≥n t√©cnica</p>
            </div>
            
            <div class="report-info">
                <div>
                    <div class="mb-1"><strong>Veh√≠culo:</strong> <span id="preview-vehiculo">[No especificado]</span></div>
                    <div class="mb-1"><strong>Dominio:</strong> <span id="preview-dominio">[No especificado]</span></div>
                    <div class="mb-1"><strong>Kilometraje:</strong> <span id="preview-kilometraje">[No especificado]</span></div>
                    <div><strong>Fecha:</strong> <span id="preview-fecha">[No especificada]</span></div>
                </div>
                
                <div>
                    <div class="mb-1"><strong>Evaluaci√≥n:</strong></div>
                    <div class="recommendation-badge" id="preview-recomendacion">No seleccionada</div>
                    <div id="preview-fundamento" style="font-size: 0.9rem; color: #666; max-width: 300px;">[No especificado]</div>
                </div>
            </div>
            
            <div class="mb-3">
                <h4 style="color: #2c3e50; margin-bottom: 1rem;">Observaciones generales</h4>
                <p id="preview-observaciones">[Sin observaciones generales]</p>
            </div>
            
            <div id="checklist-resumen">
                <!-- Generado din√°micamente -->
            </div>
            
            <div style="margin-top: 3rem; padding-top: 1.5rem; border-top: 1px solid #eee;">
                <p style="font-weight: 500;">Informe realizado por Akina Check</p>
                <p style="font-size: 0.85rem; color: #666; margin-top: 0.5rem;">
                    Desarrollado por AFM Solutions ¬∑ afmsolutions.com.ar
                </p>
            </div>
        </section>

        <!-- BOTONES DE ACCI√ìN -->
        <div class="action-buttons no-print">
            <button class="btn btn-primary" id="btn-actualizar">
                üîÑ Actualizar vista previa
            </button>
            <button class="btn btn-success" id="btn-pdf">
                üìÑ Generar PDF
            </button>
        </div>

        <!-- AVISO COMERCIAL -->
        <div class="text-center no-print" style="color: #666; font-size: 0.9rem; padding: 1rem; border-top: 1px solid #eee; margin-top: 2rem;">
            Versi√≥n de muestra. Funciones avanzadas disponibles bajo contrataci√≥n.
        </div>
    </main>

    <footer class="site-footer">
        <div>AKINA CHECK ¬∑ Sistema de informes de inspecci√≥n vehicular</div>
        <a href="https://afmsolutions.com.ar" class="developer-credit">
            Desarrollado por AFM Solutions ¬∑ afmsolutions.com.ar
        </a>
    </footer>

    <script>
        // DATOS DEL CHECKLIST
        const checklistItems = [
            { id: 1, categoria: 'critico', texto: 'Motor: funcionamiento, ruidos anormales, fugas de aceite o refrigerante' },
            { id: 2, categoria: 'critico', texto: 'Transmisi√≥n: cambios, ruidos, fugas de aceite' },
            { id: 3, categoria: 'critico', texto: 'Sistema de frenos: funcionamiento, desgaste de pastillas, nivel de l√≠quido' },
            { id: 4, categoria: 'seguridad', texto: 'Suspensi√≥n: amortiguadores, brazos, r√≥tulas, silentblocks' },
            { id: 5, categoria: 'seguridad', texto: 'Direcci√≥n: alineaci√≥n, funcionamiento, juego en volante' },
            { id: 6, categoria: 'seguridad', texto: 'Neum√°ticos: desgaste, presi√≥n, estado general' },
            { id: 7, categoria: 'seguridad', texto: 'Sistema el√©ctrico: bater√≠a, alternador, luces, instrumentos' },
            { id: 8, categoria: 'legal', texto: 'Documentaci√≥n: VTV vigente, c√©dula verde/azul, patente' },
            { id: 9, categoria: 'legal', texto: 'Identificaci√≥n: n√∫mero de chasis y motor coincidentes con documentaci√≥n' },
            { id: 10, categoria: 'legal', texto: 'Historial: verificaci√≥n de choques importantes o reparaciones estructurales' },
            { id: 11, categoria: 'estetico', texto: 'Carrocer√≠a: pintura, abolladuras, √≥xido, estado general' },
            { id: 12, categoria: 'estetico', texto: 'Interior: tapizados, tablero, funcionamiento de accesorios' },
            { id: 13, categoria: 'estetico', texto: 'Vidrios y espejos: estado, funcionamiento' },
            { id: 14, categoria: 'estetico', texto: 'Limpieza general: interior y exterior' },
            { id: 15, categoria: 'seguridad', texto: 'Seguridad activa: ABS, ESP, airbags (verificar testigos)' }
        ];

        const categorias = {
            critico: { nombre: 'Cr√≠tico', color: '#c0392b' },
            seguridad: { nombre: 'Seguridad', color: '#e67e22' },
            legal: { nombre: 'Legal', color: '#2980b9' },
            estetico: { nombre: 'Est√©tico', color: '#7f8c8d' }
        };

        // ESTADO
        let estado = {
            recomendacion: null,
            checklist: {}
        };

        // INICIALIZACI√ìN
        document.addEventListener('DOMContentLoaded', function() {
            // Fecha actual
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fecha').value = hoy;
            
            // Inicializar checklist
            inicializarChecklist();
            
            // Eventos
            configurarEventos();
            
            // Vista previa inicial
            actualizarVistaPrevia();
        });

        // CHECKLIST
        function inicializarChecklist() {
            const contenedor = document.getElementById('checklist-container');
            contenedor.innerHTML = '';

            // Agrupar por categor√≠a
            const itemsPorCategoria = {};
            checklistItems.forEach(item => {
                if (!itemsPorCategoria[item.categoria]) {
                    itemsPorCategoria[item.categoria] = [];
                }
                itemsPorCategoria[item.categoria].push(item);
            });

            // Crear secciones
            Object.keys(categorias).forEach(categoriaId => {
                const categoria = categorias[categoriaId];
                const items = itemsPorCategoria[categoriaId] || [];

                if (items.length === 0) return;

                const seccion = document.createElement('div');
                seccion.className = 'checklist-category';

                const header = document.createElement('div');
                header.className = 'category-header';
                header.style.backgroundColor = categoria.color;
                header.innerHTML = `<span>${categoria.nombre}</span><span>${items.length}</span>`;
                seccion.appendChild(header);

                // Items
                items.forEach(item => {
                    const elemento = document.createElement('div');
                    elemento.className = 'checklist-item';
                    elemento.dataset.id = item.id;

                    elemento.innerHTML = `
                        <div class="item-text">${item.texto}</div>
                        <div class="item-status">
                            <button class="status-btn status-conforme" data-estado="conforme" title="Conforme">
                                ‚úì
                            </button>
                            <button class="status-btn status-observacion" data-estado="observacion" title="Observaci√≥n">
                                !
                            </button>
                            <button class="status-btn status-no-conforme" data-estado="no-conforme" title="No conforme">
                                ‚úó
                            </button>
                        </div>
                    `;

                    // Estado inicial
                    estado.checklist[item.id] = null;

                    // Eventos
                    elemento.querySelectorAll('.status-btn').forEach(boton => {
                        boton.addEventListener('click', function() {
                            const itemId = parseInt(elemento.dataset.id);
                            const nuevoEstado = this.dataset.estado;
                            establecerEstadoChecklist(itemId, nuevoEstado, elemento);
                        });
                    });

                    seccion.appendChild(elemento);
                });

                contenedor.appendChild(seccion);
            });

            actualizarContadores();
        }

        function establecerEstadoChecklist(itemId, estadoNuevo, elemento) {
            estado.checklist[itemId] = estadoNuevo;

            // Actualizar UI
            elemento.querySelectorAll('.status-btn').forEach(boton => {
                boton.classList.remove('selected');
                if (boton.dataset.estado === estadoNuevo) {
                    boton.classList.add('selected');
                }
            });

            actualizarContadores();
            actualizarMensajeAsistencia();
        }

        // CONTADORES Y ASISTENCIA
        function actualizarContadores() {
            let observaciones = 0;
            let noConformes = 0;

            Object.values(estado.checklist).forEach(estadoItem => {
                if (estadoItem === 'observacion') observaciones++;
                if (estadoItem === 'no-conforme') noConformes++;
            });

            document.getElementById('contador-observaciones').textContent = observaciones;
            document.getElementById('contador-no-conformes').textContent = noConformes;
        }

        function actualizarMensajeAsistencia() {
            const elemento = document.getElementById('mensaje-asistencia');
            const observaciones = parseInt(document.getElementById('contador-observaciones').textContent);
            const noConformes = parseInt(document.getElementById('contador-no-conformes').textContent);

            let mensaje = 'Complete el checklist para obtener informaci√≥n contextual.';

            if (noConformes > 0) {
                mensaje = 'Se detectaron √≠tems no conformes. Requieren atenci√≥n prioritaria.';
            } else if (observaciones > 3) {
                mensaje = 'M√∫ltiples observaciones detectadas. Considere posibles implicaciones econ√≥micas.';
            } else if (observaciones > 0) {
                mensaje = 'Observaciones detectadas. Incorp√≥relas en su evaluaci√≥n final.';
            }

            elemento.textContent = mensaje;
        }

        // VISTA PREVIA
        function actualizarVistaPrevia() {
            actualizarDatosVehiculo();
            actualizarRecomendacion();
            actualizarChecklistResumen();
        }

        function actualizarDatosVehiculo() {
            document.getElementById('preview-vehiculo').textContent = 
                obtenerValor('vehiculo', '[No especificado]');
            
            document.getElementById('preview-dominio').textContent = 
                obtenerValor('dominio', '[No especificado]');
            
            document.getElementById('preview-kilometraje').textContent = 
                obtenerValor('kilometraje', '[No especificado]');
            
            const fecha = obtenerValor('fecha');
            document.getElementById('preview-fecha').textContent = 
                fecha ? formatearFecha(fecha) : '[No especificada]';
            
            document.getElementById('preview-observaciones').textContent = 
                obtenerValor('observaciones-generales', '[Sin observaciones generales]');
        }

        function actualizarRecomendacion() {
            const fundamento = obtenerValor('fundamento');
            document.getElementById('preview-fundamento').textContent = fundamento || '[No especificado]';

            const badge = document.getElementById('preview-recomendacion');
            
            switch(estado.recomendacion) {
                case 'apto':
                    badge.className = 'recommendation-badge badge-apto';
                    badge.textContent = 'Apto para compra';
                    break;
                case 'observaciones':
                    badge.className = 'recommendation-badge badge-observaciones';
                    badge.textContent = 'Apto con observaciones';
                    break;
                case 'no-recomendado':
                    badge.className = 'recommendation-badge badge-no-recomendado';
                    badge.textContent = 'No recomendado';
                    break;
                default:
                    badge.className = 'recommendation-badge';
                    badge.textContent = 'No seleccionada';
            }
        }

        function actualizarChecklistResumen() {
            const contenedor = document.getElementById('checklist-resumen');
            contenedor.innerHTML = '<h4 style="color: #2c3e50; margin-bottom: 1rem;">Resumen del checklist</h4>';

            // Por categor√≠a
            Object.keys(categorias).forEach(categoriaId => {
                const categoria = categorias[categoriaId];
                const items = checklistItems.filter(item => item.categoria === categoriaId);

                if (items.length === 0) return;

                const seccion = document.createElement('div');
                seccion.className = 'mb-3';
                seccion.innerHTML = `<h5 style="color: ${categoria.color}; margin-bottom: 0.5rem;">${categoria.nombre}</h5>`;

                items.forEach(item => {
                    const estadoItem = estado.checklist[item.id] || 'no-evaluado';
                    const textoEstado = obtenerTextoEstado(estadoItem);
                    const claseEstado = `estado-${estadoItem}`;

                    const fila = document.createElement('div');
                    fila.className = 'mb-1';
                    fila.style.display = 'flex';
                    fila.style.justifyContent = 'space-between';
                    fila.style.padding = '0.25rem 0';
                    fila.style.borderBottom = '1px solid #f0f0f0';
                    
                    fila.innerHTML = `
                        <span>${item.texto}</span>
                        <span style="font-weight: 500; color: ${obtenerColorEstado(estadoItem)}">${textoEstado}</span>
                    `;
                    
                    seccion.appendChild(fila);
                });

                contenedor.appendChild(seccion);
            });
        }

        // EVENTOS
        function configurarEventos() {
            // Opciones de recomendaci√≥n
            document.querySelectorAll('.option').forEach(opcion => {
                opcion.addEventListener('click', function() {
                    document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    estado.recomendacion = this.dataset.value;
                    actualizarRecomendacion();
                });
            });

            // Contador de caracteres
            document.getElementById('fundamento').addEventListener('input', function() {
                document.getElementById('char-count').textContent = this.value.length;
            });

            // Campos de formulario
            ['vehiculo', 'dominio', 'kilometraje', 'fecha', 'fundamento', 'observaciones-generales'].forEach(id => {
                document.getElementById(id).addEventListener('input', actualizarVistaPrevia);
            });

            // Botones
            document.getElementById('btn-actualizar').addEventListener('click', actualizarVistaPrevia);
            document.getElementById('btn-pdf').addEventListener('click', generarPDF);
        }

        // PDF
        async function generarPDF() {
            if (!estado.recomendacion) {
                alert('Seleccione una recomendaci√≥n antes de generar el PDF.');
                return;
            }

            if (!document.getElementById('fundamento').value.trim()) {
                alert('Ingrese el fundamento de la evaluaci√≥n.');
                return;
            }

            const boton = document.getElementById('btn-pdf');
            const textoOriginal = boton.innerHTML;
            boton.innerHTML = 'üîÑ Generando...';
            boton.disabled = true;

            try {
                // Cargar librer√≠as
                await cargarScript('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js');
                await cargarScript('https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js');

                const elemento = document.getElementById('report-preview');
                const canvas = await html2canvas(elemento, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });

                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 190;
                const imgHeight = canvas.height * imgWidth / canvas.width;

                pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
                
                // Pie de p√°gina
                pdf.setFontSize(8);
                pdf.setTextColor(128, 128, 128);
                pdf.text('Desarrollado por AFM Solutions ¬∑ afmsolutions.com.ar', 105, 290, { align: 'center' });

                // Descargar
                const dominio = obtenerValor('dominio') || 'informe';
                const fecha = obtenerValor('fecha') || new Date().toISOString().split('T')[0];
                pdf.save(`Informe_AkinaCheck_${dominio}_${fecha}.pdf`);

            } catch (error) {
                console.error('Error:', error);
                alert('Error al generar el PDF. Intente nuevamente.');
            } finally {
                boton.innerHTML = textoOriginal;
                boton.disabled = false;
            }
        }

        // UTILIDADES
        function obtenerValor(id, defecto = '') {
            const elemento = document.getElementById(id);
            return elemento ? elemento.value.trim() : defecto;
        }

        function formatearFecha(fechaStr) {
            const fecha = new Date(fechaStr);
            return fecha.toLocaleDateString('es-AR');
        }

        function obtenerTextoEstado(estado) {
            const map = {
                'conforme': 'Conforme',
                'observacion': 'Observaci√≥n',
                'no-conforme': 'No conforme',
                'no-evaluado': 'No evaluado'
            };
            return map[estado] || 'No evaluado';
        }

        function obtenerColorEstado(estado) {
            const map = {
                'conforme': '#27ae60',
                'observacion': '#f39c12',
                'no-conforme': '#e74c3c',
                'no-evaluado': '#95a5a6'
            };
            return map[estado] || '#95a5a6';
        }

        function cargarScript(src) {
            return new Promise((resolve, reject) => {
                if (document.querySelector(`script[src="${src}"]`)) {
                    resolve();
                    return;
                }
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
    </script>
</body>
</html>
