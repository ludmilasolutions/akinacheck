<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akina Check - Informe de Inspecci√≥n Vehicular</title>
    <style>
        /* ===== VARIABLES Y RESET ===== */
        :root {
            --color-primary: #1a365d;
            --color-secondary: #2d3748;
            --color-success: #276749;
            --color-warning: #975a16;
            --color-danger: #9b2c2c;
            --color-light: #f7fafc;
            --color-border: #e2e8f0;
            --color-text: #2d3748;
            --color-text-light: #718096;
            --font-main: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            --radius: 6px;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-main);
            color: var(--color-text);
            line-height: 1.5;
            background-color: #f8fafc;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ===== TIPOGRAF√çA ===== */
        h1, h2, h3, h4 {
            font-weight: 600;
            line-height: 1.3;
        }
        
        h1 { font-size: 2rem; }
        h2 { font-size: 1.5rem; }
        h3 { font-size: 1.25rem; }
        h4 { font-size: 1.125rem; }
        
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .text-center { text-align: center; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        
        /* ===== LAYOUT ===== */
        .container {
            display: grid;
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }
        
        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }
        
        /* ===== COMPONENTES ===== */
        .card {
            background: white;
            border-radius: var(--radius);
            border: 1px solid var(--color-border);
            padding: 24px;
            box-shadow: var(--shadow);
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--color-light);
        }
        
        .section-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--color-light);
            border-radius: 6px;
            color: var(--color-primary);
        }
        
        /* ===== HEADER ===== */
        .app-header {
            text-align: center;
            margin-bottom: 32px;
            padding: 24px 0;
            border-bottom: 1px solid var(--color-border);
        }
        
        .brand {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--color-primary);
            letter-spacing: -0.5px;
            margin-bottom: 4px;
        }
        
        .subtitle {
            color: var(--color-text-light);
            font-size: 1.125rem;
        }
        
        /* ===== PORTADA DEL INFORME ===== */
        .cover-card {
            border-left: 4px solid var(--color-primary);
            padding: 32px;
        }
        
        .cover-title {
            text-align: center;
            margin-bottom: 32px;
        }
        
        .cover-title h2 {
            color: var(--color-primary);
            margin-bottom: 8px;
        }
        
        .cover-title p {
            color: var(--color-text-light);
        }
        
        .recommendation-section {
            background: var(--color-light);
            border-radius: var(--radius);
            padding: 24px;
            margin: 32px 0;
            border: 1px solid var(--color-border);
        }
        
        .recommendation-title {
            text-align: center;
            margin-bottom: 24px;
            color: var(--color-primary);
        }
        
        .recommendation-options {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        
        .recommendation-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 16px;
            border-radius: var(--radius);
            border: 2px solid transparent;
            transition: all 0.2s ease;
            min-width: 160px;
            background: white;
        }
        
        .recommendation-option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .recommendation-option.selected {
            border-color: currentColor;
        }
        
        .recommendation-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .option-apto { color: var(--color-success); }
        .option-observaciones { color: var(--color-warning); }
        .option-no-recomendado { color: var(--color-danger); }
        
        .reason-container {
            margin-top: 24px;
        }
        
        .reason-container label {
            display: block;
            margin-bottom: 8px;
            color: var(--color-primary);
            font-weight: 500;
        }
        
        .reason-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            font-family: var(--font-main);
            font-size: 1rem;
            resize: vertical;
            min-height: 80px;
            background: white;
        }
        
        .reason-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1);
        }
        
        .vehicle-data-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 24px;
        }
        
        @media (max-width: 640px) {
            .vehicle-data-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* ===== FORMULARIOS ===== */
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            color: var(--color-primary);
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            font-family: var(--font-main);
            font-size: 1rem;
            background: white;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1);
        }
        
        /* ===== CHECKLIST ===== */
        .checklist-container {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 8px;
        }
        
        .checklist-category {
            margin-bottom: 24px;
        }
        
        .category-header {
            padding: 12px 16px;
            border-radius: var(--radius);
            margin-bottom: 16px;
            color: white;
            font-weight: 500;
        }
        
        .category-critical { background: var(--color-danger); }
        .category-safety { background: var(--color-warning); }
        .category-legal { background: var(--color-primary); }
        .category-esthetic { background: var(--color-text-light); }
        
        .checklist-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            margin-bottom: 12px;
            background: white;
            transition: border-color 0.2s ease;
        }
        
        .checklist-item:hover {
            border-color: var(--color-primary);
        }
        
        .item-text {
            flex: 1;
            padding-right: 16px;
        }
        
        .item-status {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .status-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid transparent;
            background: var(--color-light);
            font-size: 1rem;
            transition: all 0.2s ease;
        }
        
        .status-btn:hover {
            transform: scale(1.1);
        }
        
        .status-conforme {
            color: var(--color-success);
            border-color: var(--color-success);
        }
        
        .status-conforme.selected {
            background: var(--color-success);
            color: white;
        }
        
        .status-observacion {
            color: var(--color-warning);
            border-color: var(--color-warning);
        }
        
        .status-observacion.selected {
            background: var(--color-warning);
            color: white;
        }
        
        .status-no-conforme {
            color: var(--color-danger);
            border-color: var(--color-danger);
        }
        
        .status-no-conforme.selected {
            background: var(--color-danger);
            color: white;
        }
        
        /* ===== ASISTENCIA ===== */
        .assistance-panel {
            background: var(--color-light);
            padding: 20px;
            border-radius: var(--radius);
            margin-top: 24px;
            border: 1px solid var(--color-border);
        }
        
        .counters {
            display: flex;
            gap: 32px;
            margin-bottom: 20px;
        }
        
        .counter {
            text-align: center;
        }
        
        .counter-value {
            font-size: 2rem;
            font-weight: 700;
            display: block;
            line-height: 1;
        }
        
        .counter-label {
            font-size: 0.875rem;
            color: var(--color-text-light);
            margin-top: 4px;
        }
        
        .observations-counter .counter-value { color: var(--color-warning); }
        .nonconformities-counter .counter-value { color: var(--color-danger); }
        
        .assistance-message {
            padding: 12px 16px;
            background: white;
            border-radius: var(--radius);
            border-left: 4px solid var(--color-primary);
            font-style: italic;
            color: var(--color-text);
        }
        
        /* ===== VISTA PREVIA ===== */
        .report-preview {
            padding: 32px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
        }
        
        .report-header {
            text-align: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 2px solid var(--color-light);
        }
        
        .report-cover-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 32px;
            padding: 24px;
            background: var(--color-light);
            border-radius: var(--radius);
            flex-wrap: wrap;
            gap: 24px;
        }
        
        .recommendation-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.875rem;
        }
        
        .badge-apto {
            background: rgba(39, 103, 73, 0.1);
            color: var(--color-success);
        }
        
        .badge-observaciones {
            background: rgba(151, 90, 22, 0.1);
            color: var(--color-warning);
        }
        
        .badge-no-recomendado {
            background: rgba(155, 44, 44, 0.1);
            color: var(--color-danger);
        }
        
        .checklist-summary {
            margin: 32px 0;
        }
        
        .summary-category {
            margin-bottom: 24px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--color-light);
        }
        
        .summary-status {
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .summary-status-conforme { color: var(--color-success); }
        .summary-status-observacion { color: var(--color-warning); }
        .summary-status-no-conforme { color: var(--color-danger); }
        
        /* ===== BOTONES ===== */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin: 32px 0;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius);
            font-family: var(--font-main);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: var(--color-primary);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: var(--color-secondary);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-success {
            background: var(--color-success);
            color: white;
        }
        
        .btn-success:hover:not(:disabled) {
            background: #22543d;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        /* ===== BLOQUE COMERCIAL ===== */
        .commercial-notice {
            text-align: center;
            padding: 16px;
            color: var(--color-text-light);
            font-size: 0.875rem;
            margin-top: 32px;
            border-top: 1px solid var(--color-border);
        }
        
        /* ===== FOOTER ===== */
        .app-footer {
            text-align: center;
            padding: 24px 0;
            color: var(--color-text-light);
            font-size: 0.875rem;
            margin-top: 40px;
            border-top: 1px solid var(--color-border);
        }
        
        .developer-credit {
            color: var(--color-text-light);
            text-decoration: none;
        }
        
        .developer-credit:hover {
            text-decoration: underline;
        }
        
        /* ===== IMPRESI√ìN/PDF ===== */
        @media print {
            .no-print, .action-buttons, .commercial-notice {
                display: none !important;
            }
            
            body {
                padding: 0;
                background: white;
                max-width: none;
            }
            
            .card, .report-preview {
                box-shadow: none;
                border: none;
                padding: 0;
                margin: 0 0 20px 0;
            }
            
            .report-preview {
                padding: 0 !important;
            }
            
            .checklist-container {
                max-height: none;
                overflow: visible;
            }
        }
        
        /* ===== UTILIDADES ===== */
        .mb-4 { margin-bottom: 16px; }
        .mb-6 { margin-bottom: 24px; }
        .mt-4 { margin-top: 16px; }
        .mt-6 { margin-top: 24px; }
        .mb-8 { margin-bottom: 32px; }
        .mt-8 { margin-top: 32px; }
    </style>
</head>
<body>
    <!-- Header principal -->
    <header class="app-header">
        <div class="brand">AKINA CHECK</div>
        <div class="subtitle">Informe profesional de inspecci√≥n vehicular</div>
    </header>

    <!-- Portada del informe -->
    <section class="card cover-card">
        <div class="cover-title">
            <h2>Informe de inspecci√≥n vehicular</h2>
            <p>Documento t√©cnico para evaluaci√≥n pre-compra</p>
        </div>
        
        <div class="recommendation-section">
            <h3 class="recommendation-title">Evaluaci√≥n del inspector</h3>
            
            <div class="recommendation-options">
                <div class="recommendation-option option-apto" data-value="apto">
                    <div class="recommendation-icon">üü¢</div>
                    <div class="font-semibold">Apto para compra</div>
                </div>
                
                <div class="recommendation-option option-observaciones" data-value="observaciones">
                    <div class="recommendation-icon">üü°</div>
                    <div class="font-semibold">Apto con observaciones</div>
                </div>
                
                <div class="recommendation-option option-no-recomendado" data-value="no-recomendado">
                    <div class="recommendation-icon">üî¥</div>
                    <div class="font-semibold">No recomendado</div>
                </div>
            </div>
            
            <div class="reason-container">
                <label for="reason">Fundamento t√©cnico (m√°x. 200 caracteres)</label>
                <textarea id="reason" class="reason-input" placeholder="Base t√©cnica de la evaluaci√≥n..." maxlength="200"></textarea>
                <div class="text-right text-sm text-xs mt-1">
                    <span id="char-count">0</span>/200 caracteres
                </div>
            </div>
        </div>
        
        <div class="vehicle-data-grid">
            <div class="form-group">
                <label for="vehicle" class="form-label">Veh√≠culo</label>
                <input type="text" id="vehicle" class="form-control" placeholder="Ej: Volkswagen Golf 1.4 TSI">
            </div>
            
            <div class="form-group">
                <label for="plate" class="form-label">Dominio</label>
                <input type="text" id="plate" class="form-control" placeholder="Ej: AB 123 CD">
            </div>
            
            <div class="form-group">
                <label for="mileage" class="form-label">Kilometraje</label>
                <input type="text" id="mileage" class="form-control" placeholder="Ej: 125.500 km">
            </div>
            
            <div class="form-group">
                <label for="date" class="form-label">Fecha de inspecci√≥n</label>
                <input type="date" id="date" class="form-control">
            </div>
        </div>
    </section>

    <!-- Contenedor principal -->
    <div class="container grid-2">
        <!-- Datos y observaciones -->
        <section class="card">
            <div class="section-header">
                <div class="section-icon">üìã</div>
                <h3>Datos del veh√≠culo</h3>
            </div>
            
            <div class="form-group">
                <label for="notes" class="form-label">Observaciones generales</label>
                <textarea id="notes" class="form-control" rows="4" placeholder="Anotaciones relevantes sobre el veh√≠culo..."></textarea>
            </div>
            
            <!-- Panel de asistencia -->
            <div class="assistance-panel">
                <div class="counters">
                    <div class="counter observations-counter">
                        <span class="counter-value" id="observations-count">0</span>
                        <span class="counter-label">Observaciones</span>
                    </div>
                    
                    <div class="counter nonconformities-counter">
                        <span class="counter-value" id="nonconformities-count">0</span>
                        <span class="counter-label">No conformes</span>
                    </div>
                </div>
                
                <div class="assistance-message" id="assistance-message">
                    Complete la lista de verificaci√≥n para obtener informaci√≥n de contexto.
                </div>
            </div>
        </section>

        <!-- Checklist -->
        <section class="card">
            <div class="section-header">
                <div class="section-icon">‚úÖ</div>
                <h3>Lista de verificaci√≥n</h3>
            </div>
            
            <div class="checklist-container" id="checklist-container">
                <!-- Generado din√°micamente -->
            </div>
        </section>
    </div>

    <!-- Vista previa del informe -->
    <section class="report-preview card" id="report-preview">
        <div class="report-header">
            <h2>INFORME DE INSPECCI√ìN VEHICULAR</h2>
            <p class="text-sm">AKINA CHECK ¬∑ Evaluaci√≥n t√©cnica profesional</p>
        </div>
        
        <div class="report-cover-info">
            <div>
                <div class="mb-2"><span class="font-medium">Veh√≠culo:</span> <span id="preview-vehicle">[No especificado]</span></div>
                <div class="mb-2"><span class="font-medium">Dominio:</span> <span id="preview-plate">[No especificado]</span></div>
                <div class="mb-2"><span class="font-medium">Kilometraje:</span> <span id="preview-mileage">[No especificado]</span></div>
                <div><span class="font-medium">Fecha de inspecci√≥n:</span> <span id="preview-date">[No especificada]</span></div>
            </div>
            
            <div>
                <div class="mb-2"><span class="font-medium">Evaluaci√≥n:</span></div>
                <div class="recommendation-badge" id="preview-recommendation">No seleccionada</div>
                <div id="preview-reason" class="text-sm mt-2">[No especificado]</div>
            </div>
        </div>
        
        <div class="mb-8">
            <h4 class="mb-4">Observaciones generales</h4>
            <p id="preview-notes">[Sin observaciones generales]</p>
        </div>
        
        <div class="checklist-summary" id="checklist-summary">
            <!-- Generado din√°micamente -->
        </div>
        
        <div class="mt-8 pt-6 border-t border-gray-200">
            <p class="font-medium">Informe realizado por Akina Check</p>
            <p class="text-sm text-gray-600 mt-1">
                Desarrollado por AFM Solutions ¬∑ afmsolutions.com.ar
            </p>
        </div>
    </section>

    <!-- Acciones principales -->
    <div class="action-buttons no-print">
        <button class="btn btn-primary" id="update-preview-btn">
            Actualizar vista previa
        </button>
        <button class="btn btn-success" id="download-pdf-btn">
            Descargar informe PDF
        </button>
    </div>

    <!-- Bloque comercial -->
    <div class="commercial-notice no-print">
        <p>Versi√≥n de muestra. Funciones avanzadas disponibles bajo contrataci√≥n.</p>
    </div>

    <!-- Footer -->
    <footer class="app-footer">
        <p>AKINA CHECK ¬∑ Sistema de informes de inspecci√≥n vehicular</p>
        <p class="mt-2">Desarrollado por <a href="https://afmsolutions.com.ar" class="developer-credit">AFM Solutions ¬∑ afmsolutions.com.ar</a></p>
    </footer>

    <!-- Script principal -->
    <script>
        // ===== CONFIGURACI√ìN =====
        const CHECKLIST_ITEMS = [
            { id: 1, category: 'critical', text: 'Motor: funcionamiento, ruidos anormales, fugas de aceite o refrigerante' },
            { id: 2, category: 'critical', text: 'Transmisi√≥n: cambios, ruidos, fugas de aceite' },
            { id: 3, category: 'critical', text: 'Sistema de frenos: funcionamiento, desgaste de pastillas, nivel de l√≠quido' },
            { id: 4, category: 'safety', text: 'Suspensi√≥n: amortiguadores, brazos, r√≥tulas, silentblocks' },
            { id: 5, category: 'safety', text: 'Direcci√≥n: alineaci√≥n, funcionamiento, juego en volante' },
            { id: 6, category: 'safety', text: 'Neum√°ticos: desgaste, presi√≥n, estado general' },
            { id: 7, category: 'safety', text: 'Sistema el√©ctrico: bater√≠a, alternador, luces, instrumentos' },
            { id: 8, category: 'legal', text: 'Documentaci√≥n: VTV vigente, c√©dula verde/azul, patente' },
            { id: 9, category: 'legal', text: 'Identificaci√≥n: n√∫mero de chasis y motor coincidentes con documentaci√≥n' },
            { id: 10, category: 'legal', text: 'Historial: verificaci√≥n de choques importantes o reparaciones estructurales' },
            { id: 11, category: 'esthetic', text: 'Carrocer√≠a: pintura, abolladuras, √≥xido, estado general' },
            { id: 12, category: 'esthetic', text: 'Interior: tapizados, tablero, funcionamiento de accesorios' },
            { id: 13, category: 'esthetic', text: 'Vidrios y espejos: estado, funcionamiento' },
            { id: 14, category: 'esthetic', text: 'Limpieza general: interior y exterior' },
            { id: 15, category: 'safety', text: 'Seguridad activa: ABS, ESP, airbags (verificar testigos)' }
        ];

        const CATEGORIES = {
            critical: { name: 'Cr√≠tico', color: 'category-critical' },
            safety: { name: 'Seguridad', color: 'category-safety' },
            legal: { name: 'Legal', color: 'category-legal' },
            esthetic: { name: 'Est√©tico', color: 'category-esthetic' }
        };

        const STATUS_TEXTS = {
            'conforme': 'Conforme',
            'observacion': 'Observaci√≥n',
            'no-conforme': 'No conforme',
            'no-evaluado': 'No evaluado'
        };

        // ===== ESTADO DE LA APLICACI√ìN =====
        let appState = {
            recommendation: null,
            checklistStatus: {},
            lastUpdate: null
        };

        // ===== INICIALIZACI√ìN =====
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar fecha actual
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            
            // Inicializar componentes
            initChecklist();
            initEventListeners();
            updatePreview();
            
            // Configurar contador de caracteres
            document.getElementById('reason').addEventListener('input', updateCharCount);
        });

        // ===== CHECKLIST =====
        function initChecklist() {
            const container = document.getElementById('checklist-container');
            
            // Agrupar √≠tems por categor√≠a
            const itemsByCategory = groupItemsByCategory();
            
            // Crear interfaz
            container.innerHTML = '';
            
            Object.keys(CATEGORIES).forEach(categoryId => {
                const category = CATEGORIES[categoryId];
                const items = itemsByCategory[categoryId] || [];
                
                if (items.length === 0) return;
                
                // Crear secci√≥n de categor√≠a
                const categorySection = document.createElement('div');
                categorySection.className = 'checklist-category';
                
                // Encabezado de categor√≠a
                const header = document.createElement('div');
                header.className = `category-header ${category.color}`;
                header.innerHTML = `
                    <span>${category.name}</span>
                    <span class="text-sm">(${items.length})</span>
                `;
                categorySection.appendChild(header);
                
                // Agregar √≠tems
                items.forEach(item => {
                    const itemElement = createChecklistItem(item);
                    categorySection.appendChild(itemElement);
                    
                    // Estado inicial
                    if (!appState.checklistStatus[item.id]) {
                        appState.checklistStatus[item.id] = null;
                    }
                });
                
                container.appendChild(categorySection);
            });
            
            updateCounters();
        }

        function groupItemsByCategory() {
            const groups = {};
            CHECKLIST_ITEMS.forEach(item => {
                if (!groups[item.category]) {
                    groups[item.category] = [];
                }
                groups[item.category].push(item);
            });
            return groups;
        }

        function createChecklistItem(item) {
            const element = document.createElement('div');
            element.className = 'checklist-item';
            element.dataset.itemId = item.id;
            
            element.innerHTML = `
                <div class="item-text">${item.text}</div>
                <div class="item-status">
                    <button type="button" class="status-btn status-conforme" data-status="conforme" title="Conforme">
                        ‚úì
                    </button>
                    <button type="button" class="status-btn status-observacion" data-status="observacion" title="Observaci√≥n">
                        !
                    </button>
                    <button type="button" class="status-btn status-no-conforme" data-status="no-conforme" title="No conforme">
                        ‚úó
                    </button>
                </div>
            `;
            
            return element;
        }

        function setChecklistStatus(itemId, status) {
            appState.checklistStatus[itemId] = status;
            
            // Actualizar interfaz
            const itemElement = document.querySelector(`[data-item-id="${itemId}"]`);
            if (itemElement) {
                // Remover selecci√≥n anterior
                itemElement.querySelectorAll('.status-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                // Marcar selecci√≥n actual
                const selectedBtn = itemElement.querySelector(`[data-status="${status}"]`);
                if (selectedBtn) {
                    selectedBtn.classList.add('selected');
                }
            }
            
            updateCounters();
            updateAssistanceMessage();
        }

        // ===== CONTADORES Y ASISTENCIA =====
        function updateCounters() {
            let observations = 0;
            let nonconformities = 0;
            
            Object.values(appState.checklistStatus).forEach(status => {
                if (status === 'observacion') observations++;
                if (status === 'no-conforme') nonconformities++;
            });
            
            document.getElementById('observations-count').textContent = observations;
            document.getElementById('nonconformities-count').textContent = nonconformities;
        }

        function updateAssistanceMessage() {
            const element = document.getElementById('assistance-message');
            const observations = parseInt(document.getElementById('observations-count').textContent);
            const nonconformities = parseInt(document.getElementById('nonconformities-count').textContent);
            
            let message = 'Complete la lista de verificaci√≥n para obtener informaci√≥n de contexto.';
            
            if (nonconformities > 0) {
                message = 'Se detectaron √≠tems no conformes que requieren atenci√≥n prioritaria.';
            } else if (observations > 3) {
                message = 'M√∫ltiples observaciones detectadas. Eval√∫e posibles implicaciones en el costo total.';
            } else if (observations > 0) {
                message = 'Observaciones detectadas. Considere en su evaluaci√≥n final.';
            }
            
            element.textContent = message;
        }

        // ===== VISTA PREVIA =====
        function updatePreview() {
            updatePreviewVehicleData();
            updatePreviewRecommendation();
            updatePreviewChecklist();
            appState.lastUpdate = new Date().toISOString();
        }

        function updatePreviewVehicleData() {
            document.getElementById('preview-vehicle').textContent = 
                getInputValue('vehicle', '[No especificado]');
            
            document.getElementById('preview-plate').textContent = 
                getInputValue('plate', '[No especificado]');
            
            document.getElementById('preview-mileage').textContent = 
                getInputValue('mileage', '[No especificado]');
            
            const dateValue = getInputValue('date');
            document.getElementById('preview-date').textContent = 
                dateValue ? formatDate(dateValue) : '[No especificada]';
            
            document.getElementById('preview-notes').textContent = 
                getInputValue('notes', '[Sin observaciones generales]');
        }

        function updatePreviewRecommendation() {
            const reason = getInputValue('reason');
            document.getElementById('preview-reason').textContent = 
                reason || '[No especificado]';
            
            const badge = document.getElementById('preview-recommendation');
            
            switch(appState.recommendation) {
                case 'apto':
                    badge.className = 'recommendation-badge badge-apto';
                    badge.textContent = 'Apto para compra';
                    break;
                case 'observaciones':
                    badge.className = 'recommendation-badge badge-observaciones';
                    badge.textContent = 'Apto con observaciones';
                    break;
                case 'no-recomendado':
                    badge.className = 'recommendation-badge badge-no-recomendado';
                    badge.textContent = 'No recomendado';
                    break;
                default:
                    badge.className = 'recommendation-badge';
                    badge.textContent = 'No seleccionada';
            }
        }

        function updatePreviewChecklist() {
            const container = document.getElementById('checklist-summary');
            container.innerHTML = '<h3 class="mb-6">Resumen de verificaci√≥n t√©cnica</h3>';
            
            // Agrupar por categor√≠a
            Object.keys(CATEGORIES).forEach(categoryId => {
                const category = CATEGORIES[categoryId];
                const items = CHECKLIST_ITEMS.filter(item => item.category === categoryId);
                
                if (items.length === 0) return;
                
                const section = document.createElement('div');
                section.className = 'summary-category';
                
                const title = document.createElement('h4');
                title.className = 'font-semibold mb-4';
                title.textContent = category.name;
                section.appendChild(title);
                
                items.forEach(item => {
                    const status = appState.checklistStatus[item.id] || 'no-evaluado';
                    const statusText = STATUS_TEXTS[status] || 'No evaluado';
                    const statusClass = `summary-status summary-status-${status}`;
                    
                    const itemElement = document.createElement('div');
                    itemElement.className = 'summary-item';
                    itemElement.innerHTML = `
                        <span>${item.text}</span>
                        <span class="${statusClass}">${statusText}</span>
                    `;
                    section.appendChild(itemElement);
                });
                
                container.appendChild(section);
            });
        }

        // ===== EVENTOS =====
        function initEventListeners() {
            // Recomendaci√≥n
            document.querySelectorAll('.recommendation-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.recommendation-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    appState.recommendation = this.dataset.value;
                    updatePreviewRecommendation();
                });
            });
            
            // Checklist (delegaci√≥n de eventos)
            document.getElementById('checklist-container').addEventListener('click', function(e) {
                const statusBtn = e.target.closest('.status-btn');
                if (!statusBtn) return;
                
                const itemElement = statusBtn.closest('.checklist-item');
                const itemId = parseInt(itemElement.dataset.itemId);
                const status = statusBtn.dataset.status;
                
                setChecklistStatus(itemId, status);
            });
            
            // Datos del formulario
            ['vehicle', 'plate', 'mileage', 'date', 'reason', 'notes'].forEach(id => {
                document.getElementById(id).addEventListener('input', updatePreview);
            });
            
            // Botones de acci√≥n
            document.getElementById('update-preview-btn').addEventListener('click', updatePreview);
            document.getElementById('download-pdf-btn').addEventListener('click', downloadPDF);
        }

        function updateCharCount() {
            const element = document.getElementById('reason');
            document.getElementById('char-count').textContent = element.value.length;
        }

        // ===== PDF =====
        async function downloadPDF() {
            // Validaci√≥n b√°sica
            if (!appState.recommendation) {
                alert('Seleccione una evaluaci√≥n antes de generar el PDF.');
                return;
            }
            
            if (!document.getElementById('reason').value.trim()) {
                alert('Ingrese el fundamento t√©cnico antes de generar el PDF.');
                return;
            }
            
            // Estado del bot√≥n
            const button = document.getElementById('download-pdf-btn');
            const originalText = button.innerHTML;
            button.innerHTML = 'Generando PDF...';
            button.disabled = true;
            
            try {
                // Cargar librer√≠as din√°micamente
                await loadScript('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js');
                await loadScript('https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js');
                
                // Generar PDF
                const element = document.getElementById('report-preview');
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });
                
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 190;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                
                pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
                
                // Pie de p√°gina
                pdf.setFontSize(8);
                pdf.setTextColor(128, 128, 128);
                pdf.text('Desarrollado por AFM Solutions ¬∑ afmsolutions.com.ar', 105, 290, { align: 'center' });
                
                // Descargar
                const plate = getInputValue('plate') || 'informe';
                const date = getInputValue('date') || new Date().toISOString().split('T')[0];
                pdf.save(`Informe_AkinaCheck_${plate}_${date}.pdf`);
                
            } catch (error) {
                console.error('Error al generar PDF:', error);
                alert('Error al generar el PDF. Por favor, intente nuevamente.');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        // ===== UTILIDADES =====
        function getInputValue(id, defaultValue = '') {
            const element = document.getElementById(id);
            return element ? element.value.trim() : defaultValue;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-AR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                if (document.querySelector(`script[src="${src}"]`)) {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
    </script>
</body>
</html>
